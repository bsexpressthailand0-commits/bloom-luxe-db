<!doctype html>
<html lang="th" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BLOOM LUXE SALON (Auto Login)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body { box-sizing: border-box; font-family: 'Prompt', sans-serif; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-slide-in { animation: slideIn 0.3s ease-out forwards; }
    @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 10px rgba(139, 92, 246, 0.2); } 50% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.6); } }
    .queue-active { animation: pulse-glow 2s infinite; border: 1px solid rgba(139, 92, 246, 0.5); }
    @keyframes blink-green { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    .live-dot { animation: blink-green 2s infinite; }
    .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); }
    .glass-input { width: 100%; padding: 12px 16px; border-radius: 12px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); color: white; outline: none; transition: all 0.3s; }
    .glass-input:focus { border-color: #a78bfa; box-shadow: 0 0 0 2px rgba(167, 139, 250, 0.2); }
    .radio-box { display: flex; align-items: center; gap: 10px; padding: 10px 14px; border-radius: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); cursor: pointer; transition: all 0.2s; }
    .radio-box:hover { background: rgba(255, 255, 255, 0.1); border-color: rgba(139, 92, 246, 0.4); }
    .radio-box input:checked + span { color: #d8b4fe; font-weight: 600; }
    .tab-btn { background: rgba(139, 92, 246, 0.1); color: #a78bfa; transition: all 0.3s; }
    .tab-btn.active { background: linear-gradient(135deg, #8B5CF6, #6D28D9); color: white; box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3); }
    .hidden-elm { display: none !important; }
    .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; }
    .status-waiting { background: rgba(234, 179, 8, 0.2); color: #fde047; border: 1px solid rgba(234, 179, 8, 0.3); }
    .status-serving { background: rgba(34, 197, 94, 0.2); color: #86efac; border: 1px solid rgba(34, 197, 94, 0.3); }
    .status-completed { background: rgba(148, 163, 184, 0.2); color: #cbd5e1; border: 1px solid rgba(148, 163, 184, 0.3); }
    .queue-number { font-family: 'Courier New', monospace; letter-spacing: -1px; }
  </style>
 </head>
 <body class="h-full m-0 p-0 bg-[#0f172a]">
  
  <div id="app" class="h-full w-full overflow-auto min-h-screen" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);">
    
    <!-- Navigation -->
    <nav class="flex justify-between items-center px-6 py-4 bg-black/20 backdrop-blur-md sticky top-0 z-50">
        <div class="flex items-center gap-2">
            <span class="text-2xl">üå∏</span>
            <div class="flex flex-col">
                <span class="text-white font-bold tracking-wider hidden md:block leading-tight">BLOOM LUXE</span>
                <div class="flex items-center gap-1.5" id="live-indicator">
                    <div id="status-dot" class="w-2 h-2 rounded-full bg-yellow-500"></div>
                    <span id="status-text" class="text-[10px] text-yellow-400 font-medium uppercase tracking-widest">Checking...</span>
                </div>
            </div>
        </div>
        <div class="flex gap-2">
            <button onclick="showPage('customer')" id="nav-customer" class="px-4 py-2 rounded-lg text-sm font-medium bg-purple-600 text-white shadow-lg">Customer</button>
            <button onclick="showPage('admin')" id="nav-admin" class="px-4 py-2 rounded-lg text-sm font-medium text-gray-400 hover:text-white">Staff Only</button>
        </div>
    </nav>

    <!-- ================= CUSTOMER PAGE ================= -->
    <div id="page-customer" class="max-w-2xl mx-auto px-4 pb-12 pt-6 animate-slide-in">
      
      <div class="glass-panel rounded-3xl p-6 mb-6 text-center relative overflow-hidden">
         <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-purple-500 via-pink-500 to-purple-500"></div>
         <h2 class="text-xl font-bold text-white mb-1">Your Needs Test</h2>
         <p class="text-purple-200/70 text-sm">‡πÅ‡∏ö‡∏ö‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏•‡∏±‡∏Å‡∏ã‡πå‡∏ä‡∏π‡∏£‡∏µ</p>
      </div>

      <div class="flex gap-4 mb-6">
          <button onclick="switchCustomerView('form')" id="btn-view-form" class="flex-1 py-3 rounded-2xl font-bold bg-white text-purple-900 shadow-lg scale-105">üìù ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
          <button onclick="switchCustomerView('queue')" id="btn-view-queue" class="flex-1 py-3 rounded-2xl font-bold bg-white/10 text-purple-300">üëÄ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏¥‡∏ß</button>
      </div>

      <!-- 1. Form View -->
      <div id="customer-form-view" class="glass-panel rounded-3xl p-6 md:p-8 shadow-2xl animate-slide-in">
        <form id="customer-form" class="space-y-8">
            <div class="flex bg-black/20 p-1.5 rounded-2xl">
                <button type="button" onclick="switchFormTab('walkin')" id="tab-walkin" class="flex-1 py-3 rounded-xl font-medium text-sm transition-all tab-btn active">üö∂ Walk-in</button>
                <button type="button" onclick="switchFormTab('booking')" id="tab-booking" class="flex-1 py-3 rounded-xl font-medium text-sm transition-all tab-btn">üìÖ Booking</button>
            </div>
            <input type="hidden" id="form-order-type" name="orderType" value="walkin">

            <div id="booking-section" class="hidden-elm p-5 rounded-2xl border border-dashed border-purple-500/40 bg-purple-500/5">
                <div class="grid grid-cols-2 gap-4">
                    <div><label class="block text-purple-200/70 text-xs mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" name="bookingDate" class="glass-input"></div>
                    <div><label class="block text-purple-200/70 text-xs mb-2">‡πÄ‡∏ß‡∏•‡∏≤</label><input type="time" name="bookingTime" class="glass-input"></div>
                </div>
            </div>

            <div>
                <label class="block text-purple-200 text-sm mb-2">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô / Nickname</label>
                <input type="text" name="nickname" required class="glass-input" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô...">
            </div>

            <div>
                <label class="block text-purple-200 text-sm mb-2">‡πÄ‡∏û‡∏®</label>
                <div class="flex gap-3">
                    <label class="radio-box flex-1 justify-center"><input type="radio" name="gender" value="‡∏ä‡∏≤‡∏¢ (Male)" required class="accent-purple-500"><span class="text-gray-300 text-sm">‡∏ä‡∏≤‡∏¢</span></label>
                    <label class="radio-box flex-1 justify-center"><input type="radio" name="gender" value="‡∏´‡∏ç‡∏¥‡∏á (Female)" class="accent-purple-500"><span class="text-gray-300 text-sm">‡∏´‡∏ç‡∏¥‡∏á</span></label>
                </div>
            </div>

            <div class="space-y-6">
                 <div><label class="block text-purple-200 text-sm mb-3">üå°Ô∏è ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ô‡πâ‡∏≥</label>
                    <div class="flex gap-3">
                        <label class="radio-box flex-1 justify-center"><input type="radio" name="waterTemp" value="‡∏≠‡∏∏‡πà‡∏ô" required class="accent-purple-500"><span class="text-gray-300 text-sm">‡∏≠‡∏∏‡πà‡∏ô</span></label>
                        <label class="radio-box flex-1 justify-center"><input type="radio" name="waterTemp" value="‡πÄ‡∏¢‡πá‡∏ô" class="accent-purple-500"><span class="text-gray-300 text-sm">‡πÄ‡∏¢‡πá‡∏ô</span></label>
                    </div>
                 </div>
                 <div><label class="block text-purple-200 text-sm mb-3">üåø ‡∏Å‡∏•‡∏¥‡πà‡∏ô‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏´‡∏≠‡∏°‡∏£‡∏∞‡πÄ‡∏´‡∏¢</label>
                    <div class="grid grid-cols-2 gap-3">
                        <label class="radio-box"><input type="radio" name="oil" value="Jasmine Rice" required class="accent-purple-500"><span class="text-gray-300 text-xs">Jasmine Rice</span></label>
                        <label class="radio-box"><input type="radio" name="oil" value="White Tea" class="accent-purple-500"><span class="text-gray-300 text-xs">White Tea</span></label>
                        <label class="radio-box"><input type="radio" name="oil" value="Marigold" class="accent-purple-500"><span class="text-gray-300 text-xs">Marigold</span></label>
                        <label class="radio-box"><input type="radio" name="oil" value="Orchid" class="accent-purple-500"><span class="text-gray-300 text-xs">Orchid</span></label>
                    </div>
                 </div>
                 <div class="grid grid-cols-2 gap-4">
                    <div><label class="block text-purple-200 text-sm mb-2">‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ô‡∏ß‡∏î</label>
                        <select name="massagePressure" class="glass-input"><option>‡πÄ‡∏ö‡∏≤</option><option>‡∏Å‡∏•‡∏≤‡∏á</option><option>‡∏´‡∏ô‡∏±‡∏Å</option></select>
                    </div>
                    <div><label class="block text-purple-200 text-sm mb-2">‡πÄ‡∏Å‡∏≤‡∏®‡∏µ‡∏£‡∏©‡∏∞</label>
                        <select name="headPressure" class="glass-input"><option>‡πÄ‡∏ö‡∏≤</option><option>‡∏Å‡∏•‡∏≤‡∏á</option><option>‡∏´‡∏ô‡∏±‡∏Å</option></select>
                    </div>
                 </div>
                 <div><label class="block text-purple-200 text-sm mb-2">‚ö†Ô∏è ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©</label><textarea name="caution" rows="2" class="glass-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏ú‡∏•‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î, ‡∏ú‡∏¥‡∏ß‡πÅ‡∏û‡πâ‡∏á‡πà‡∏≤‡∏¢..."></textarea></div>
            </div>

            <button type="submit" id="submit-btn" class="w-full py-4 rounded-xl font-bold text-white text-lg bg-gradient-to-r from-purple-600 to-pink-600 shadow-lg shadow-purple-500/30 transition-all hover:scale-[1.02]">
                <span id="submit-text">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏¥‡∏ß‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</span>
            </button>
        </form>
      </div>

      <!-- 2. Live Queue View -->
      <div id="customer-queue-view" class="hidden-elm animate-slide-in">
          <div class="glass-panel p-6 rounded-3xl text-center mb-6 relative overflow-hidden bg-gradient-to-br from-purple-900/40 to-black/40">
            <div class="text-purple-200 text-sm uppercase tracking-widest mb-2 animate-pulse">Now Serving</div>
            <div class="text-6xl md:text-8xl font-bold text-green-400 queue-number mb-2" id="cust-display-queue">-</div>
            <div class="text-xl text-white font-bold" id="cust-display-name">...</div>
          </div>

          <h3 class="text-white font-bold mb-4 flex items-center gap-2"><span>‚è≥</span> ‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠</h3>
          <div id="cust-waiting-list" class="space-y-3">
              <div class="text-center text-gray-500 py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏¥‡∏ß...</div>
          </div>
      </div>
    </div>

    <!-- ================= ADMIN PAGE ================= -->
    <div id="page-admin" class="hidden-elm max-w-4xl mx-auto px-4 pb-12 pt-6 animate-slide-in">
        <div class="glass-panel p-6 rounded-3xl text-center mb-6 relative">
            <div class="text-purple-200 text-sm uppercase tracking-widest mb-2">Now Serving (Staff View)</div>
            <div class="text-6xl md:text-8xl font-bold text-white queue-number mb-2" id="admin-display-queue">-</div>
            <div class="text-xl text-purple-300" id="admin-display-name">Waiting...</div>
        </div>

        <div class="grid grid-cols-3 gap-4 mb-6">
            <div class="glass-panel p-4 rounded-2xl text-center"><div class="text-3xl font-bold text-yellow-400" id="count-waiting">0</div><div class="text-xs text-gray-400">Waiting</div></div>
            <div class="glass-panel p-4 rounded-2xl text-center"><div class="text-3xl font-bold text-green-400" id="count-serving">0</div><div class="text-xs text-gray-400">Serving</div></div>
            <div class="glass-panel p-4 rounded-2xl text-center"><div class="text-3xl font-bold text-blue-400" id="count-total">0</div><div class="text-xs text-gray-400">Today</div></div>
        </div>

        <!-- System Settings Section -->
        <div class="mb-6 flex justify-between items-center px-2">
            <h3 class="text-white font-bold">üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
            <button onclick="toggleSettings()" class="text-xs text-purple-400 hover:text-white transition-all bg-white/5 px-3 py-1.5 rounded-lg">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö Database</button>
        </div>

        <div id="settings-panel" class="hidden-elm glass-panel p-5 rounded-2xl mb-6 border border-purple-500/30">
            <h4 class="text-white font-bold text-sm mb-3">GitHub Configuration (Hardcoded)</h4>
            <div class="text-[10px] text-gray-400 mb-2">Using configuration from code.</div>
            <div class="space-y-3">
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="text-[10px] text-gray-400 block mb-1">GitHub Username</label>
                        <input type="text" id="db-owner-input" class="glass-input text-xs" readonly>
                    </div>
                    <div>
                        <label class="text-[10px] text-gray-400 block mb-1">Repository Name</label>
                        <input type="text" id="db-repo-input" class="glass-input text-xs" readonly>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="autoFix404()" id="btn-autofix" class="hidden-elm flex-1 py-3 bg-green-600 text-white rounded-xl text-xs font-bold shadow-lg shadow-green-600/20">üõ†Ô∏è ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå database.json (‡πÅ‡∏Å‡πâ Error 404)</button>
                </div>
            </div>
        </div>

        <div id="admin-order-list" class="space-y-4">
            <div class="text-center text-gray-500 py-10">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏¥‡∏ß...</div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="hidden-elm fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm">
        <div class="glass-panel p-8 rounded-2xl w-80 text-center">
            <h3 class="text-xl font-bold text-white mb-4">üîê Staff Login</h3>
            <input type="password" id="admin-pass" class="glass-input text-center mb-4" placeholder="Password">
            <button onclick="checkLogin()" class="w-full py-3 bg-purple-600 text-white rounded-xl font-bold">Login</button>
            <button onclick="showPage('customer')" class="mt-4 text-sm text-gray-400 underline">Back</button>
        </div>
    </div>

    <div id="toast-container" class="fixed top-4 right-4 z-[70] space-y-2 pointer-events-none"></div>
  </div>

  <script>
    // ==========================================
    // üîó GitHub JSON Database Config (Embedded)
    // ==========================================
    const CONFIG = {
        // 1. ‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÅ‡∏•‡∏∞ Repo ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á
        owner: 'bsexpressthailand0-commits', 
        repo: 'bloom-luxe-db',
        path: 'database.json',

        // 2. ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™ Token ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡∏´‡∏±‡πà‡∏ô‡∏Ñ‡∏£‡∏∂‡πà‡∏á (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏•‡∏ö Bot ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö)
        token_part_1: 'ghp_',  // ‡πÉ‡∏™‡πà ghp_ ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
        token_part_2: 'vR7WEYSOvVyhEK8mLFQk2OL5AZXW4A0Hwv6R'  // ‡πÉ‡∏™‡πà‡∏™‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏¢‡∏≤‡∏ß‡πÜ ‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    };
    
    // ‡∏£‡∏ß‡∏°‡∏£‡∏´‡∏±‡∏™ Token ‡∏à‡∏≤‡∏Å 2 ‡∏™‡πà‡∏ß‡∏ô
    const getAuthToken = () => CONFIG.token_part_1 + CONFIG.token_part_2;

    const getHeaders = () => {
        const token = getAuthToken();
        const headers = { 'Accept': 'application/vnd.github.v3+json', 'Content-Type': 'application/json' };
        if(token) headers['Authorization'] = `token ${token}`;
        return headers;
    };

    let db_sha = '';
    let db_content = [];
    let activePage = 'customer';
    let isFetching = false;

    window.onload = () => {
        // Show hardcoded values in UI for verification
        const ownerInput = document.getElementById('db-owner-input');
        const repoInput = document.getElementById('db-repo-input');
        
        if(ownerInput) ownerInput.value = CONFIG.owner;
        if(repoInput) repoInput.value = CONFIG.repo;
        
        refreshData();
        setInterval(refreshData, 5000); 
    };

    async function refreshData() {
        if (isFetching) return;
        isFetching = true;
        
        const url = `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.path}`;
        
        try {
            const res = await fetch(`${url}?t=${Date.now()}`, { headers: getHeaders() });
            if (res.ok) {
                const data = await res.json();
                db_sha = data.sha;
                db_content = JSON.parse(decodeURIComponent(escape(atob(data.content))));
                renderUI();
                updateStatusIcon('live');
                document.getElementById('btn-autofix').classList.add('hidden-elm'); 
            } else {
                console.error("Fetch Error:", res.status);
                updateStatusIcon('error', res.status);
                
                // 404 Not Found -> ‡∏´‡∏≤‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡πÄ‡∏à‡∏≠ ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° Auto Fix
                if(res.status === 404) {
                    const btn = document.getElementById('btn-autofix');
                    if(btn) btn.classList.remove('hidden-elm');
                }
            }
        } catch (e) {
            console.error(e);
            updateStatusIcon('error', 'NET');
        } finally {
            isFetching = false;
        }
    }

    async function autoFix404() {
        const btn = document.getElementById('btn-autofix');
        btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå...";
        btn.disabled = true;

        const url = `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.path}`;
        
        try {
            // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå database.json ‡∏ß‡πà‡∏≤‡∏á‡πÜ []
            const res = await fetch(url, {
                method: 'PUT',
                headers: getHeaders(),
                body: JSON.stringify({
                    message: "Create database.json (Auto Fix)",
                    content: "W10=", // Base64 ‡∏Ç‡∏≠‡∏á []
                })
            });
            
            if(res.ok) {
                showToast("‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô", "success");
                btn.classList.add('hidden-elm');
                refreshData();
            } else {
                const err = await res.json();
                showToast(`‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${err.message}`, "error");
                btn.innerText = "‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á";
                btn.disabled = false;
            }
        } catch(e) {
            showToast("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠", "error");
            btn.innerText = "‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á";
            btn.disabled = false;
        }
    }

    async function saveToGithub(newContent) {
        const url = `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.path}`;
        try {
            const res = await fetch(url, {
                method: 'PUT',
                headers: getHeaders(),
                body: JSON.stringify({
                    message: `Update: ${new Date().toISOString()}`,
                    content: btoa(unescape(encodeURIComponent(JSON.stringify(newContent, null, 2)))),
                    sha: db_sha
                })
            });
            return res.ok;
        } catch (e) {
            return false;
        }
    }

    // --- UI RENDER ---
    function renderUI() {
        const serving = db_content.find(i => i.status === 'Serving');
        const waiting = db_content.filter(i => i.status === 'Waiting');

        const custQ = document.getElementById('cust-display-queue');
        const custN = document.getElementById('cust-display-name');
        if(custQ) custQ.innerText = serving ? serving.id : '-';
        if(custN) custN.innerText = serving ? serving.nickname : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏¥‡∏ß‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ';

        const custWaitingList = document.getElementById('cust-waiting-list');
        if(custWaitingList) {
            custWaitingList.innerHTML = waiting.length ? '' : '<div class="text-gray-500 text-center py-6 bg-white/5 rounded-2xl border border-white/5">‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏¥‡∏ß‡∏£‡∏≠...</div>';
            waiting.forEach(q => {
                custWaitingList.innerHTML += `
                    <div class="flex justify-between items-center p-5 bg-white/5 rounded-2xl animate-slide-in border border-white/5">
                        <div class="flex items-center gap-4">
                            <div class="font-mono text-2xl font-bold text-white">${q.id}</div>
                            <div class="text-gray-300 font-medium">${q.nickname}</div>
                        </div>
                        <span class="status-badge status-waiting">Waiting</span>
                    </div>`;
            });
        }

        if (activePage === 'admin') {
            document.getElementById('admin-display-queue').innerText = serving ? serving.id : '-';
            document.getElementById('admin-display-name').innerText = serving ? serving.nickname : 'No Serving';
            document.getElementById('count-waiting').innerText = waiting.length;
            document.getElementById('count-serving').innerText = serving ? 1 : 0;
            document.getElementById('count-total').innerText = db_content.length;

            const adminList = document.getElementById('admin-order-list');
            if(adminList) {
                adminList.innerHTML = '';
                const sorted = [...db_content].sort((a,b) => (a.status === 'Serving' ? -1 : 1));
                sorted.forEach(q => {
                    const isServing = q.status === 'Serving';
                    adminList.innerHTML += `
                        <div class="glass-panel p-5 rounded-3xl animate-slide-in ${isServing ? 'border-purple-500/50 bg-purple-500/10' : ''}">
                            <div class="flex justify-between mb-4">
                                <div class="flex items-center gap-4">
                                    <div class="bg-white/10 px-3 py-1.5 rounded-lg text-lg font-mono text-white border border-white/10">${q.id}</div>
                                    <div class="text-white font-bold text-lg">${q.nickname} <span class="font-normal text-xs opacity-50">(${q.gender})</span></div>
                                </div>
                                <span class="status-badge ${isServing ? 'status-serving' : 'status-waiting'}">${q.status}</span>
                            </div>
                            <div class="grid grid-cols-2 gap-3 text-xs text-gray-300 mb-5 bg-black/20 p-4 rounded-2xl">
                                <div>üå°Ô∏è ‡∏ô‡πâ‡∏≥: <span class="text-white font-medium">${q.waterTemp || '-'}</span></div>
                                <div>üåø ‡∏Å‡∏•‡∏¥‡πà‡∏ô: <span class="text-white font-medium">${q.oil || '-'}</span></div>
                                <div>üíÜ ‡∏ô‡∏ß‡∏î: <span class="text-white font-medium">${q.massagePressure || '-'}</span></div>
                                <div>üíÜ‚Äç‚ôÄÔ∏è ‡∏´‡∏±‡∏ß: <span class="text-white font-medium">${q.headPressure || '-'}</span></div>
                                <div class="col-span-2 pt-2 border-t border-white/5 text-pink-300">‚ö†Ô∏è ‡∏à‡∏∏‡∏î‡∏£‡∏∞‡∏ß‡∏±‡∏á: ${q.caution || '‡πÑ‡∏°‡πà‡∏°‡∏µ'}</div>
                            </div>
                            <div class="flex gap-3 justify-end">
                                ${q.status === 'Waiting' ? `<button onclick="updateStatus('${q.id}', 'Serving')" class="bg-green-600 hover:bg-green-500 px-5 py-2.5 rounded-xl text-xs font-bold text-white transition-all shadow-lg shadow-green-600/20">‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏¥‡∏ß (Start)</button>` : ''}
                                ${q.status === 'Serving' ? `<button onclick="updateStatus('${q.id}', 'Done')" class="bg-blue-600 hover:bg-blue-500 px-5 py-2.5 rounded-xl text-xs font-bold text-white transition-all shadow-lg shadow-blue-600/20">‡πÄ‡∏™‡∏£‡πá‡∏à‡∏á‡∏≤‡∏ô (Done)</button>` : ''}
                                <button onclick="updateStatus('${q.id}', 'Delete')" class="bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white px-4 py-2.5 rounded-xl text-xs transition-all">‡∏•‡∏ö</button>
                            </div>
                        </div>`;
                });
            }
        }
    }

    // --- LOGIC ---
    document.getElementById('customer-form').onsubmit = async (e) => {
        e.preventDefault();
        const btn = document.getElementById('submit-btn');
        btn.disabled = true;
        btn.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
        const fd = new FormData(e.target);
        const nextId = "Q-" + String(db_content.length + 1).padStart(3, '0');
        const newEntry = {
            id: nextId,
            status: 'Waiting',
            timestamp: new Date().toISOString(),
            ...Object.fromEntries(fd.entries())
        };
        const updatedDB = [...db_content, newEntry];
        if (await saveToGithub(updatedDB)) {
            showToast('‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ ' + nextId, 'success');
            e.target.reset();
            switchCustomerView('queue');
            refreshData();
        } else {
            showToast('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™ Token', 'error');
        }
        btn.disabled = false;
        btn.innerText = '‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏¥‡∏ß‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£';
    };

    async function updateStatus(id, newStatus) {
        let updatedDB;
        if (newStatus === 'Delete' || newStatus === 'Done') {
            updatedDB = db_content.filter(i => i.id !== id);
        } else {
            updatedDB = db_content.map(i => {
                if (i.id === id) return { ...i, status: newStatus };
                if (newStatus === 'Serving' && i.status === 'Serving') return null; 
                return i;
            }).filter(Boolean);
        }
        if (await saveToGithub(updatedDB)) {
            showToast('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            refreshData();
        }
    }

    // --- SETTINGS LOGIC ---
    function toggleSettings() {
        const p = document.getElementById('settings-panel');
        p.classList.toggle('hidden-elm');
    }

    function updateStatusIcon(state, code = '') {
        const dot = document.getElementById('status-dot');
        const text = document.getElementById('status-text');
        if(!dot || !text) return;
        
        if(state === 'error') {
            dot.className = 'w-2 h-2 rounded-full bg-red-500';
            text.innerText = `Offline (${code})`;
            text.className = 'text-[10px] text-red-400 uppercase tracking-widest';
        } else {
            dot.className = 'w-2 h-2 rounded-full bg-green-500 live-dot';
            text.innerText = 'Live System';
            text.className = 'text-[10px] text-green-400 uppercase tracking-widest';
        }
    }

    // --- NAVIGATION HELPERS ---
    function showPage(page) {
        activePage = page;
        if (page === 'admin') {
            document.getElementById('login-modal').classList.remove('hidden-elm');
        } else {
            document.getElementById('page-customer').classList.remove('hidden-elm');
            document.getElementById('page-admin').classList.add('hidden-elm');
            document.getElementById('login-modal').classList.add('hidden-elm');
            toggleNavStyle('customer');
        }
    }

    function checkLogin() {
        if (document.getElementById('admin-pass').value === '1234') {
            document.getElementById('login-modal').classList.add('hidden-elm');
            document.getElementById('page-customer').classList.add('hidden-elm');
            document.getElementById('page-admin').classList.remove('hidden-elm');
            toggleNavStyle('admin');
            renderUI();
        } else {
            showToast('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
        }
    }

    function toggleNavStyle(active) {
        const c = document.getElementById('nav-customer'), a = document.getElementById('nav-admin');
        if (active === 'customer') {
            c.className = 'px-4 py-2 rounded-lg text-sm font-medium bg-purple-600 text-white shadow-lg';
            a.className = 'px-4 py-2 rounded-lg text-sm font-medium text-gray-400';
        } else {
            a.className = 'px-4 py-2 rounded-lg text-sm font-medium bg-purple-600 text-white shadow-lg';
            c.className = 'px-4 py-2 rounded-lg text-sm font-medium text-gray-400';
        }
    }

    function switchCustomerView(view) {
        const f = document.getElementById('customer-form-view'), q = document.getElementById('customer-queue-view');
        const bf = document.getElementById('btn-view-form'), bq = document.getElementById('btn-view-queue');
        if (view === 'form') {
            f.classList.remove('hidden-elm'); q.classList.add('hidden-elm');
            bf.className = 'flex-1 py-3 rounded-2xl font-bold bg-white text-purple-900 shadow-lg scale-105';
            bq.className = 'flex-1 py-3 rounded-2xl font-bold bg-white/10 text-purple-300';
        } else {
            q.classList.remove('hidden-elm'); f.classList.add('hidden-elm');
            bq.className = 'flex-1 py-3 rounded-2xl font-bold bg-white text-purple-900 shadow-lg scale-105';
            bf.className = 'flex-1 py-3 rounded-2xl font-bold bg-white/10 text-purple-300';
            refreshData();
        }
    }

    function switchFormTab(type) {
        document.getElementById('form-order-type').value = type;
        document.getElementById('booking-section').className = type === 'booking' ? 'p-5 rounded-2xl border border-dashed border-purple-500/40 bg-purple-500/5' : 'hidden-elm';
        document.getElementById('tab-walkin').className = type === 'walkin' ? 'flex-1 py-3 rounded-xl font-medium text-sm transition-all tab-btn active' : 'flex-1 py-3 rounded-xl font-medium text-sm transition-all tab-btn';
        document.getElementById('tab-booking').className = type === 'booking' ? 'flex-1 py-3 rounded-xl font-medium text-sm transition-all tab-btn active' : 'flex-1 py-3 rounded-xl font-medium text-sm transition-all tab-btn';
    }

    function showToast(m, t) {
        const c = document.getElementById('toast-container'), el = document.createElement('div');
        el.className = `animate-slide-in px-6 py-4 rounded-2xl text-white text-sm shadow-2xl pointer-events-auto ${t==='success'?'bg-green-600/90':'bg-red-600/90'}`;
        el.innerText = m; c.appendChild(el);
        setTimeout(() => el.remove(), 4000);
    }
  </script>
 </body>
</html>
