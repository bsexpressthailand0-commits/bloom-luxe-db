<!doctype html>
<html lang="th" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>BLOOM LUXE SALON (Smart Notify)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body { box-sizing: border-box; font-family: 'Prompt', sans-serif; overflow-x: hidden; }
    @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    .animate-slide-in { animation: slideIn 0.3s ease-out forwards; }
    @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 10px rgba(139, 92, 246, 0.2); } 50% { box-shadow: 0 0 20px rgba(139, 92, 246, 0.6); } }
    .queue-active { animation: pulse-glow 2s infinite; border: 1px solid rgba(139, 92, 246, 0.5); }
    @keyframes blink-green { 0%, 100% { opacity: 1; } 50% { opacity: 0.4; } }
    .live-dot { animation: blink-green 2s infinite; }
    .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.05); }
    .glass-input { width: 100%; padding: 12px 16px; border-radius: 12px; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(139, 92, 246, 0.3); color: white; outline: none; transition: all 0.3s; }
    .glass-input:focus { border-color: #a78bfa; box-shadow: 0 0 0 2px rgba(167, 139, 250, 0.2); }
    .radio-box { display: flex; align-items: center; gap: 8px; padding: 10px 12px; border-radius: 12px; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); cursor: pointer; transition: all 0.2s; min-width: 0; }
    .radio-box:hover { background: rgba(255, 255, 255, 0.1); border-color: rgba(139, 92, 246, 0.4); }
    .radio-box input:checked + span { color: #d8b4fe; font-weight: 600; }
    .tab-btn { background: rgba(139, 92, 246, 0.1); color: #a78bfa; transition: all 0.3s; }
    .tab-btn.active { background: linear-gradient(135deg, #8B5CF6, #6D28D9); color: white; box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3); }
    .hidden-elm { display: none !important; }
    .status-badge { padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; }
    .status-waiting { background: rgba(234, 179, 8, 0.2); color: #fde047; border: 1px solid rgba(234, 179, 8, 0.3); }
    .status-serving { background: rgba(34, 197, 94, 0.2); color: #86efac; border: 1px solid rgba(34, 197, 94, 0.3); }
    .status-completed { background: rgba(148, 163, 184, 0.2); color: #cbd5e1; border: 1px solid rgba(148, 163, 184, 0.3); }
    .queue-number { font-family: 'Courier New', monospace; letter-spacing: -1px; }
    
    /* Notification Bar Animation */
    @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    .my-queue-bar { animation: slideUp 0.5s ease-out forwards; }

    /* Input Date/Time Styling for Mobile */
    input[type="date"], input[type="time"] {
        color-scheme: dark; /* Forces native picker to be dark mode */
    }
    input[type="date"]::-webkit-calendar-picker-indicator,
    input[type="time"]::-webkit-calendar-picker-indicator {
        filter: invert(1);
        opacity: 0.7;
        cursor: pointer;
    }
  </style>
 </head>
 <body class="h-full m-0 p-0 bg-[#0f172a] overflow-x-hidden">
   
  <div id="app" class="h-full w-full overflow-x-hidden min-h-screen pb-20" style="background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);">
     
    <!-- Navigation -->
    <nav class="flex justify-between items-center px-4 md:px-6 py-4 bg-black/20 backdrop-blur-md sticky top-0 z-50 w-full">
        <div class="flex items-center gap-2 shrink-0">
            <span class="text-2xl">üå∏</span>
            <div class="flex flex-col">
                <span class="text-white font-bold tracking-wider hidden md:block leading-tight">BLOOM LUXE</span>
                <div class="flex items-center gap-1.5" id="live-indicator">
                    <div id="status-dot" class="w-2 h-2 rounded-full bg-yellow-500"></div>
                    <span id="status-text" class="text-[10px] text-yellow-400 font-medium uppercase tracking-widest">Checking...</span>
                </div>
            </div>
        </div>
        <div class="flex gap-2 shrink-0">
            <button onclick="showPage('customer')" id="nav-customer" class="px-3 py-1.5 md:px-4 md:py-2 rounded-lg text-xs md:text-sm font-medium bg-purple-600 text-white shadow-lg whitespace-nowrap">Customer</button>
            <button onclick="showPage('admin')" id="nav-admin" class="px-3 py-1.5 md:px-4 md:py-2 rounded-lg text-xs md:text-sm font-medium text-gray-400 hover:text-white whitespace-nowrap">Staff Only</button>
        </div>
    </nav>

    <!-- ================= CUSTOMER PAGE ================= -->
    <div id="page-customer" class="max-w-2xl mx-auto px-4 pb-12 pt-6 animate-slide-in w-full">
      
      <div class="glass-panel rounded-3xl p-5 md:p-6 mb-6 text-center relative overflow-hidden">
         <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-purple-500 via-pink-500 to-purple-500"></div>
         <h2 class="text-xl font-bold text-white mb-1">BLOOM LUXE SALON</h2>
         <p class="text-purple-200/70 text-sm">‡∏à‡∏≠‡∏á‡∏Ñ‡∏¥‡∏ß‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</p>
      </div>

      <div class="flex gap-3 md:gap-4 mb-6">
          <button onclick="switchCustomerView('form')" id="btn-view-form" class="flex-1 py-3 rounded-2xl font-bold bg-white text-purple-900 shadow-lg scale-105 text-sm md:text-base">üìù ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</button>
          <button onclick="switchCustomerView('queue')" id="btn-view-queue" class="flex-1 py-3 rounded-2xl font-bold bg-white/10 text-purple-300 text-sm md:text-base">üëÄ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏¥‡∏ß</button>
      </div>

      <!-- 1. Form View -->
      <div id="customer-form-view" class="glass-panel rounded-3xl p-5 md:p-8 shadow-2xl animate-slide-in w-full">
        <form id="customer-form" class="space-y-6 md:space-y-8">
            <div class="flex bg-black/20 p-1.5 rounded-2xl">
                <button type="button" onclick="switchFormTab('walkin')" id="tab-walkin" class="flex-1 py-3 rounded-xl font-medium text-sm transition-all tab-btn active">üö∂ Walk-in</button>
                <button type="button" onclick="switchFormTab('booking')" id="tab-booking" class="flex-1 py-3 rounded-xl font-medium text-sm transition-all tab-btn">üìÖ Booking</button>
            </div>
            <input type="hidden" id="form-order-type" name="orderType" value="walkin">

            <div id="booking-section" class="hidden-elm mt-6 animate-slide-in">
                <div class="bg-white/5 border border-white/10 rounded-2xl p-4 md:p-5 relative overflow-hidden w-full">
                    <!-- Decor -->
                    <div class="absolute -top-10 -right-10 w-32 h-32 bg-purple-500/20 rounded-full blur-3xl pointer-events-none"></div>
                    
                    <div class="flex items-center gap-2 mb-4 text-purple-300">
                        <span class="text-xl">üìÖ</span>
                        <span class="font-bold text-sm">‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢ (Booking)</span>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Date Input -->
                        <div class="relative group w-full">
                            <label class="block text-purple-200/70 text-xs mb-1.5 ml-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (Date)</label>
                            <div class="relative w-full">
                                <input type="date" name="bookingDate" class="glass-input w-full pl-10 h-12 text-white bg-white/10 border-purple-500/30 focus:border-purple-400 focus:bg-white/20 transition-all rounded-xl cursor-pointer">
                                <div class="absolute left-3 top-1/2 -translate-y-1/2 text-purple-300 pointer-events-none">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                                </div>
                            </div>
                        </div>

                        <!-- Time Input -->
                        <div class="relative group w-full">
                            <label class="block text-purple-200/70 text-xs mb-1.5 ml-1">‡πÄ‡∏ß‡∏•‡∏≤ (Time)</label>
                            <div class="relative w-full">
                                <input type="time" name="bookingTime" class="glass-input w-full pl-10 h-12 text-white bg-white/10 border-purple-500/30 focus:border-purple-400 focus:bg-white/20 transition-all rounded-xl cursor-pointer">
                                <div class="absolute left-3 top-1/2 -translate-y-1/2 text-purple-300 pointer-events-none">
                                     <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-3 text-[10px] text-gray-400 text-center bg-black/20 rounded-lg py-2 px-3 border border-white/5">
                        *‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏°‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏±‡∏î‡∏´‡∏°‡∏≤‡∏¢ 10 ‡∏ô‡∏≤‡∏ó‡∏µ
                    </div>
                </div>
            </div>

            <div class="w-full">
                <label class="block text-purple-200 text-sm mb-2">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô / Nickname</label>
                <input type="text" name="nickname" required class="glass-input w-full" placeholder="‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô...">
            </div>

            <div class="w-full">
                <label class="block text-purple-200 text-sm mb-2">‡πÄ‡∏û‡∏® (Gender)</label>
                <div class="flex gap-3 w-full">
                    <label class="radio-box flex-1 justify-center"><input type="radio" name="gender" value="‡∏ä‡∏≤‡∏¢ (Male)" required class="accent-purple-500"><span class="text-gray-300 text-sm">‡∏ä‡∏≤‡∏¢</span></label>
                    <label class="radio-box flex-1 justify-center"><input type="radio" name="gender" value="‡∏´‡∏ç‡∏¥‡∏á (Female)" class="accent-purple-500"><span class="text-gray-300 text-sm">‡∏´‡∏ç‡∏¥‡∏á</span></label>
                </div>
            </div>

            <div class="space-y-6 w-full">
                 <div class="w-full"><label class="block text-purple-200 text-sm mb-3">üå°Ô∏è ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏Ç‡∏≠‡∏á‡∏ô‡πâ‡∏≥/Water temperature</label>
                    <div class="flex gap-3 w-full">
                        <label class="radio-box flex-1 justify-center"><input type="radio" name="waterTemp" value="‡∏≠‡∏∏‡πà‡∏ô" required class="accent-purple-500"><span class="text-gray-300 text-sm">‡∏≠‡∏∏‡πà‡∏ô</span></label>
                        <label class="radio-box flex-1 justify-center"><input type="radio" name="waterTemp" value="‡πÄ‡∏¢‡πá‡∏ô" class="accent-purple-500"><span class="text-gray-300 text-sm">‡πÄ‡∏¢‡πá‡∏ô</span></label>
                    </div>
                 </div>
                 
                 <div class="w-full"><label class="block text-purple-200 text-sm mb-3">üåø Signature Oil Massage</label>
                    <div class="grid grid-cols-2 gap-3 w-full">
                        <label class="radio-box w-full"><input type="radio" name="oil" value="Jasmine Rice" required class="accent-purple-500"><span class="text-gray-300 text-xs">‡∏ô‡πâ‡∏≥‡∏°‡∏±‡∏ô‡∏Ç‡πâ‡∏≤‡∏ß/Jasmine rice</span></label>
                        <label class="radio-box w-full"><input type="radio" name="oil" value="White Tea" class="accent-purple-500"><span class="text-gray-300 text-xs">‡πÑ‡∏£‡∏ó‡πå/White tea</span></label>
                        <label class="radio-box w-full"><input type="radio" name="oil" value="Marigold" class="accent-purple-500"><span class="text-gray-300 text-xs">‡∏°‡∏≤‡∏£‡∏¥‡πÇ‡∏Å‡∏•‡πå‡∏î/Marigold</span></label>
                        <label class="radio-box w-full"><input type="radio" name="oil" value="Orchid" class="accent-purple-500"><span class="text-gray-300 text-xs">‡∏Å‡∏•‡πâ‡∏ß‡∏¢‡πÑ‡∏°‡πâ/Orchid</span></label>
                    </div>
                 </div>

                 <div class="w-full"><label class="block text-purple-200 text-sm mb-3">üß¥ The scent of shampoo</label>
                    <div class="grid grid-cols-2 gap-3 w-full">
                        <label class="radio-box w-full"><input type="radio" name="shampoo" value="Chance rich" required class="accent-purple-500"><span class="text-gray-300 text-xs">Chance rich</span></label>
                        <label class="radio-box w-full"><input type="radio" name="shampoo" value="Honey sunset" class="accent-purple-500"><span class="text-gray-300 text-xs">Honey sunset</span></label>
                        <label class="radio-box w-full"><input type="radio" name="shampoo" value="Pink Gold" class="accent-purple-500"><span class="text-gray-300 text-xs">Pink Gold</span></label>
                    </div>
                 </div>

                 <div class="w-full"><label class="block text-purple-200 text-sm mb-3">üíÜ ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏°‡∏∑‡∏≠‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏ß‡∏î/Levels of massage</label>
                    <div class="flex gap-2 w-full">
                        <label class="radio-box flex-1 justify-center"><input type="radio" name="massagePressure" value="‡πÄ‡∏ö‡∏≤ Gentle" class="accent-purple-500"><span class="text-gray-300 text-xs">‡πÄ‡∏ö‡∏≤ Gentle</span></label>
                        <label class="radio-box flex-1 justify-center"><input type="radio" name="massagePressure" value="‡∏Å‡∏•‡∏≤‡∏á Medium" class="accent-purple-500"><span class="text-gray-300 text-xs">‡∏Å‡∏•‡∏≤‡∏á Medium</span></label>
                        <label class="radio-box flex-1 justify-center"><input type="radio" name="massagePressure" value="‡∏´‡∏ô‡∏±‡∏Å Strong" class="accent-purple-500"><span class="text-gray-300 text-xs">‡∏´‡∏ô‡∏±‡∏Å Strong</span></label>
                    </div>
                 </div>

                 <div class="w-full"><label class="block text-purple-200 text-sm mb-3">üíÜ‚Äç‚ôÄÔ∏è ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏°‡∏∑‡∏≠‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏≤‡∏®‡∏µ‡∏£‡∏©‡∏∞/Level of pressure hair</label>
                    <div class="flex gap-2 w-full">
                        <label class="radio-box flex-1 justify-center"><input type="radio" name="headPressure" value="‡πÄ‡∏ö‡∏≤ Gentle" class="accent-purple-500"><span class="text-gray-300 text-xs">‡πÄ‡∏ö‡∏≤ Gentle</span></label>
                        <label class="radio-box flex-1 justify-center"><input type="radio" name="headPressure" value="‡∏Å‡∏•‡∏≤‡∏á Medium" class="accent-purple-500"><span class="text-gray-300 text-xs">‡∏Å‡∏•‡∏≤‡∏á Medium</span></label>
                        <label class="radio-box flex-1 justify-center"><input type="radio" name="headPressure" value="‡∏´‡∏ô‡∏±‡∏Å Strong" class="accent-purple-500"><span class="text-gray-300 text-xs">‡∏´‡∏ô‡∏±‡∏Å Strong</span></label>
                    </div>
                 </div>

                 <div class="w-full"><label class="block text-purple-200 text-sm mb-2">‚ö†Ô∏è ‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©</label><textarea name="caution" rows="2" class="glass-input w-full" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡πÅ‡∏ú‡∏•‡∏ú‡πà‡∏≤‡∏ï‡∏±‡∏î, ‡∏ú‡∏¥‡∏ß‡πÅ‡∏û‡πâ‡∏á‡πà‡∏≤‡∏¢..."></textarea></div>
            </div>

            <button type="submit" id="submit-btn" class="w-full py-4 rounded-xl font-bold text-white text-lg bg-gradient-to-r from-purple-600 to-pink-600 shadow-lg shadow-purple-500/30 transition-all hover:scale-[1.02]">
                <span id="submit-text">‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏¥‡∏ß‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠)</span>
            </button>
            <div class="text-[10px] text-purple-300 text-center mt-2 opacity-70">*‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏£‡∏≤‡∏ö‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏¥‡∏ß</div>
        </form>
      </div>

      <!-- 2. Live Queue View -->
      <div id="customer-queue-view" class="hidden-elm animate-slide-in">
          <div class="glass-panel p-6 rounded-3xl text-center mb-6 relative overflow-hidden bg-gradient-to-br from-purple-900/40 to-black/40">
            <div class="text-purple-200 text-sm uppercase tracking-widest mb-2 animate-pulse">Now Serving</div>
            <div class="text-6xl md:text-8xl font-bold text-green-400 queue-number mb-2" id="cust-display-queue">-</div>
            <div class="text-xl text-white font-bold" id="cust-display-name">...</div>
          </div>

          <h3 class="text-white font-bold mb-4 flex items-center gap-2"><span>‚è≥</span> ‡∏Ñ‡∏¥‡∏ß‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏£‡∏≠</h3>
          <div id="cust-waiting-list" class="space-y-3">
              <div class="text-center text-gray-500 py-4">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏¥‡∏ß...</div>
          </div>
      </div>
    </div>

    <!-- ================= ADMIN PAGE ================= -->
    <div id="page-admin" class="hidden-elm max-w-4xl mx-auto px-4 pb-12 pt-6 animate-slide-in w-full">
        <div class="glass-panel p-6 rounded-3xl text-center mb-6 relative">
            <div class="text-purple-200 text-sm uppercase tracking-widest mb-2">Now Serving (Staff View)</div>
            <div class="text-6xl md:text-8xl font-bold text-white queue-number mb-2" id="admin-display-queue">-</div>
            <div class="text-xl text-purple-300" id="admin-display-name">Waiting...</div>
        </div>

        <div class="grid grid-cols-3 gap-4 mb-6">
            <div class="glass-panel p-4 rounded-2xl text-center"><div class="text-3xl font-bold text-yellow-400" id="count-waiting">0</div><div class="text-xs text-gray-400">Total Waiting</div></div>
            <div class="glass-panel p-4 rounded-2xl text-center"><div class="text-3xl font-bold text-green-400" id="count-serving">0</div><div class="text-xs text-gray-400">Serving</div></div>
            <div class="glass-panel p-4 rounded-2xl text-center"><div class="text-3xl font-bold text-blue-400" id="count-total">0</div><div class="text-xs text-gray-400">Today</div></div>
        </div>

        <!-- System Settings Section -->
        <div class="mb-4 flex justify-between items-center px-2">
            <h3 class="text-white font-bold">üìã ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏¥‡∏ß (Management)</h3>
            <button onclick="toggleSettings()" class="text-xs text-purple-400 hover:text-white transition-all bg-white/5 px-3 py-1.5 rounded-lg">‚öôÔ∏è Config</button>
        </div>

        <div id="settings-panel" class="hidden-elm glass-panel p-5 rounded-2xl mb-6 border border-purple-500/30">
            <h4 class="text-white font-bold text-sm mb-3">GitHub Configuration (Hardcoded)</h4>
            <div class="text-[10px] text-gray-400 mb-2">Using configuration from code.</div>
            <div class="space-y-3">
                <div class="grid grid-cols-2 gap-2">
                    <div>
                        <label class="text-[10px] text-gray-400 block mb-1">GitHub Username</label>
                        <input type="text" id="db-owner-input" class="glass-input text-xs" readonly>
                    </div>
                    <div>
                        <label class="text-[10px] text-gray-400 block mb-1">Repository Name</label>
                        <input type="text" id="db-repo-input" class="glass-input text-xs" readonly>
                    </div>
                </div>
                <div class="flex gap-2">
                    <button onclick="autoFix404()" id="btn-autofix" class="hidden-elm flex-1 py-3 bg-green-600 text-white rounded-xl text-xs font-bold shadow-lg shadow-green-600/20">üõ†Ô∏è ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå database.json (‡πÅ‡∏Å‡πâ Error 404)</button>
                </div>

                <!-- NEW: Split Reset Buttons -->
                <div class="pt-4 mt-2 border-t border-white/10">
                    <div class="grid grid-cols-2 gap-3 mb-2">
                        <button onclick="resetQueueByType('walkin')" class="py-3 bg-red-500/10 text-red-400 hover:bg-red-600 hover:text-white border border-red-500/30 rounded-xl text-xs font-bold transition-all flex flex-col items-center justify-center gap-1">
                            <span class="text-lg">üóëÔ∏èüö∂</span> 
                            <span>‡∏•‡πâ‡∏≤‡∏á Walk-in</span>
                        </button>
                        <button onclick="resetQueueByType('booking')" class="py-3 bg-orange-500/10 text-orange-400 hover:bg-orange-600 hover:text-white border border-orange-500/30 rounded-xl text-xs font-bold transition-all flex flex-col items-center justify-center gap-1">
                            <span class="text-lg">üóëÔ∏èüìÖ</span> 
                            <span>‡∏•‡πâ‡∏≤‡∏á Booking</span>
                        </button>
                    </div>
                    <div class="text-[10px] text-gray-500 text-center">‡∏Å‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà (‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏ñ‡∏≤‡∏ß‡∏£)</div>
                </div>
            </div>
        </div>

        <!-- Admin Tabs -->
        <div class="flex bg-black/20 p-1.5 rounded-2xl mb-4">
            <button type="button" onclick="switchAdminTab('walkin')" id="admin-tab-walkin" class="flex-1 py-3 rounded-xl font-medium text-sm transition-all tab-btn active">
                üö∂ Walk-in (<span id="badge-walkin">0</span>)
            </button>
            <button type="button" onclick="switchAdminTab('booking')" id="admin-tab-booking" class="flex-1 py-3 rounded-xl font-medium text-sm transition-all tab-btn">
                üìÖ Booking (<span id="badge-booking">0</span>)
            </button>
        </div>

        <!-- 1. Walk-in List -->
        <div id="admin-walkin-list" class="space-y-4">
            <!-- Content filled by JS -->
        </div>

        <!-- 2. Booking List -->
        <div id="admin-booking-list" class="space-y-4 hidden-elm">
            <!-- Content filled by JS -->
        </div>
    </div>
    
    <!-- CUSTOMER BOTTOM BAR (MY QUEUE) -->
    <div id="my-queue-bar" class="fixed bottom-0 left-0 w-full z-40 p-4 hidden-elm my-queue-bar">
        <div class="glass-panel p-4 rounded-2xl bg-[#0f172a]/95 border-purple-500/50 shadow-[0_-10px_40px_rgba(139,92,246,0.3)] flex justify-between items-center relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-r from-purple-600/20 to-pink-600/20 animate-pulse"></div>
            <div class="relative z-10 flex items-center gap-3">
                <div class="bg-purple-600 px-3 py-1 rounded-lg text-white font-bold text-lg shadow-lg" id="bar-my-id">Q-001</div>
                <div class="flex flex-col">
                    <span class="text-[10px] text-purple-200 uppercase tracking-widest">Your Queue</span>
                    <span class="text-white font-bold text-sm" id="bar-my-status">Waiting...</span>
                </div>
            </div>
            <button onclick="switchCustomerView('queue')" class="relative z-10 bg-white/10 hover:bg-white/20 px-3 py-1.5 rounded-lg text-xs text-white transition-all">
                View
            </button>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="login-modal" class="hidden-elm fixed inset-0 z-[60] flex items-center justify-center bg-black/80 backdrop-blur-sm">
        <div class="glass-panel p-8 rounded-2xl w-80 text-center">
            <h3 class="text-xl font-bold text-white mb-4">üîê Staff Login</h3>
            <input type="password" id="admin-pass" class="glass-input text-center mb-4" placeholder="Password">
            <button onclick="checkLogin()" class="w-full py-3 bg-purple-600 text-white rounded-xl font-bold">Login</button>
            <button onclick="showPage('customer')" class="mt-4 text-sm text-gray-400 underline">Back</button>
        </div>
    </div>

    <div id="toast-container" class="fixed top-4 right-4 z-[70] space-y-2 pointer-events-none"></div>
    
    <!-- Audio Element for Sound Alert -->
    <audio id="notify-sound" src="https://assets.mixkit.co/active_storage/sfx/2869/2869-preview.mp3" preload="auto"></audio>
  </div>

  <script>
    // ==========================================
    // üîó GitHub JSON Database Config
    // ==========================================
    const CONFIG = {
        owner: 'bsexpressthailand0-commits', 
        repo: 'bloom-luxe-db',
        path: 'database.json',
        token_part_1: 'ghp_',  
        token_part_2: 'h6daIFVk1iI75xLCB6ENeLj9gP4aZC4CqLwM'
    };
     
    const getAuthToken = () => CONFIG.token_part_1 + CONFIG.token_part_2;
    const getHeaders = () => {
        const token = getAuthToken();
        const headers = { 'Accept': 'application/vnd.github.v3+json', 'Content-Type': 'application/json' };
        if(token) headers['Authorization'] = `token ${token}`;
        return headers;
    };

    let db_sha = '';
    let db_content = [];
    let activePage = 'customer';
    let activeAdminTab = 'walkin';
    let isFetching = false;
    let myQueueId = localStorage.getItem('bloom_my_queue_id'); // Load saved queue ID
    let lastKnownStatus = localStorage.getItem('bloom_my_queue_status');

    window.onload = () => {
        const ownerInput = document.getElementById('db-owner-input');
        const repoInput = document.getElementById('db-repo-input');
        if(ownerInput) ownerInput.value = CONFIG.owner;
        if(repoInput) repoInput.value = CONFIG.repo;
        
        // Request Notification Permission on load if user has a queue
        if(myQueueId && "Notification" in window && Notification.permission !== "granted") {
            Notification.requestPermission();
        }

        refreshData();
        setInterval(refreshData, 5000); 
    };

    // --- NOTIFICATION HELPERS ---
    function triggerAlert() {
        // 1. Play Sound
        const audio = document.getElementById('notify-sound');
        if(audio) {
            audio.currentTime = 0;
            audio.play().catch(e => console.log("Audio play blocked by browser policy"));
        }

        // 2. Vibration (Mobile)
        if (navigator.vibrate) {
            navigator.vibrate([200, 100, 200]);
        }

        // 3. Browser Notification
        if ("Notification" in window && Notification.permission === "granted") {
            new Notification("üéâ ‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß!", {
                body: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ BLOOM LUXE ‡∏Ñ‡πà‡∏∞",
                icon: "https://cdn-icons-png.flaticon.com/512/3756/3756353.png"
            });
        }
        
        // 4. In-App Toast
        showToast("üîî ‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß! ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡πÉ‡∏´‡πâ‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£", "success");
    }

    function checkMyQueueStatus(data) {
        if (!myQueueId) {
            document.getElementById('my-queue-bar').classList.add('hidden-elm');
            return;
        }

        const myQueue = data.find(q => q.id === myQueueId);
        
        if (myQueue) {
            // Update Bar UI
            document.getElementById('my-queue-bar').classList.remove('hidden-elm');
            document.getElementById('bar-my-id').innerText = myQueue.id;
            document.getElementById('bar-my-status').innerText = myQueue.status === 'Serving' ? 'üéâ ‡∏ñ‡∏∂‡∏á‡∏Ñ‡∏¥‡∏ß‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏•‡πâ‡∏ß!' : 'Waiting...';
            document.getElementById('bar-my-status').className = myQueue.status === 'Serving' ? 'text-green-400 font-bold text-sm animate-pulse' : 'text-white font-bold text-sm';

            // Check for Status Change to Serving
            if (myQueue.status === 'Serving' && lastKnownStatus !== 'Serving') {
                triggerAlert();
                lastKnownStatus = 'Serving';
                localStorage.setItem('bloom_my_queue_status', 'Serving');
            }
        } else {
            // Queue might be deleted or done
            if (lastKnownStatus !== 'Done' && lastKnownStatus !== 'Delete') {
                // Optional: Auto hide bar if queue is gone
                // document.getElementById('my-queue-bar').classList.add('hidden-elm');
            }
        }
    }

    async function refreshData() {
        if (isFetching) return;
        isFetching = true;
        
        const url = `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.path}`;
        
        try {
            const res = await fetch(`${url}?t=${Date.now()}`, { headers: getHeaders() });
            if (res.ok) {
                const data = await res.json();
                db_sha = data.sha;
                db_content = JSON.parse(decodeURIComponent(escape(atob(data.content))));
                renderUI();
                checkMyQueueStatus(db_content); // Check for notification
                updateStatusIcon('live');
                document.getElementById('btn-autofix').classList.add('hidden-elm'); 
            } else {
                updateStatusIcon('error', res.status);
                if(res.status === 404) {
                    const btn = document.getElementById('btn-autofix');
                    if(btn) btn.classList.remove('hidden-elm');
                }
            }
        } catch (e) {
            console.error(e);
            updateStatusIcon('error', 'NET');
        } finally {
            isFetching = false;
        }
    }

    async function autoFix404() {
        const btn = document.getElementById('btn-autofix');
        btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå...";
        btn.disabled = true;
        const url = `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.path}`;
        try {
            const res = await fetch(url, {
                method: 'PUT',
                headers: getHeaders(),
                body: JSON.stringify({
                    message: "Create database.json (Auto Fix)",
                    content: "W10=", 
                })
            });
            if(res.ok) {
                showToast("‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô", "success");
                btn.classList.add('hidden-elm');
                refreshData();
            } else {
                const err = await res.json();
                showToast(`‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${err.message}`, "error");
                btn.innerText = "‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á";
                btn.disabled = false;
            }
        } catch(e) {
            showToast("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠", "error");
            btn.innerText = "‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á";
            btn.disabled = false;
        }
    }

    async function saveToGithub(newContent) {
        const url = `https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/${CONFIG.path}`;
        try {
            const res = await fetch(url, {
                method: 'PUT',
                headers: getHeaders(),
                body: JSON.stringify({
                    message: `Update: ${new Date().toISOString()}`,
                    content: btoa(unescape(encodeURIComponent(JSON.stringify(newContent, null, 2)))),
                    sha: db_sha
                })
            });
            return res.ok;
        } catch (e) {
            return false;
        }
    }

    async function resetQueueByType(type) {
        let confirmMsg = "";
        if (type === 'walkin') confirmMsg = "‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô: ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏¥‡∏ß 'Walk-in' ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Booking ‡∏à‡∏∞‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà)";
        if (type === 'booking') confirmMsg = "‚ö†Ô∏è ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô: ‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ñ‡∏¥‡∏ß 'Booking' ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?\n(‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Walk-in ‡∏à‡∏∞‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà)";

        if(!confirm(confirmMsg)) return;

        const btn = event.target.closest('button');
        const originalText = btn.innerHTML;
        btn.innerText = "Wait...";
        btn.disabled = true;

        let newContent = [];
        if (type === 'walkin') {
            newContent = db_content.filter(item => item.orderType === 'booking');
        } else if (type === 'booking') {
            newContent = db_content.filter(item => item.orderType !== 'booking');
        }

        if (await saveToGithub(newContent)) {
            showToast(`‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡∏¥‡∏ß ${type} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß`, 'success');
            refreshData();
        } else {
            showToast('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
        }
        
        btn.innerHTML = originalText;
        btn.disabled = false;
    }

    // --- UI RENDER ---
    function createAdminCard(q, isServing = false) {
        const isBooking = q.orderType === 'booking';
        const timeDisplay = isBooking ? `üìÖ ${q.bookingDate || ''} | ‚è∞ ${q.bookingTime || '??:??'}` : `üïí Walk-in (${q.timestamp.split('T')[1].slice(0,5)})`;
        const timeColor = isBooking ? 'text-orange-400' : 'text-gray-400';

        return `
            <div class="glass-panel p-5 rounded-3xl animate-slide-in ${isServing ? 'border-purple-500/50 bg-purple-500/10' : ''}">
                <div class="flex justify-between mb-2">
                    <div class="flex items-center gap-3">
                        <div class="bg-white/10 px-3 py-1.5 rounded-lg text-lg font-mono text-white border border-white/10">${q.id}</div>
                        <div>
                            <div class="text-white font-bold text-lg leading-tight">${q.nickname} <span class="font-normal text-xs opacity-50">(${q.gender})</span></div>
                            <div class="text-xs ${timeColor} font-bold mt-0.5">${timeDisplay}</div>
                        </div>
                    </div>
                    <span class="status-badge ${isServing ? 'status-serving' : (isBooking ? 'bg-orange-500/20 text-orange-300 border border-orange-500/30' : 'status-waiting')}">
                        ${isServing ? 'Serving' : (isBooking ? 'Booking' : 'Walk-in')}
                    </span>
                </div>
                
                <div class="grid grid-cols-2 gap-3 text-xs text-gray-300 mb-4 bg-black/20 p-3 rounded-xl mt-3">
                    <div>üå°Ô∏è ‡∏ô‡πâ‡∏≥: <span class="text-white font-medium">${q.waterTemp || '-'}</span></div>
                    <div>üåø ‡∏Å‡∏•‡∏¥‡πà‡∏ô: <span class="text-white font-medium">${q.oil || '-'}</span></div>
                    <div>üß¥ ‡πÅ‡∏ä‡∏°‡∏û‡∏π: <span class="text-white font-medium">${q.shampoo || '-'}</span></div>
                    <div>üíÜ ‡∏ô‡∏ß‡∏î: <span class="text-white font-medium">${q.massagePressure || '-'}</span></div>
                    <div>üíÜ‚Äç‚ôÄÔ∏è ‡∏´‡∏±‡∏ß: <span class="text-white font-medium">${q.headPressure || '-'}</span></div>
                    ${q.caution ? `<div class="col-span-2 pt-2 border-t border-white/5 text-pink-300">‚ö†Ô∏è ‡∏à‡∏∏‡∏î‡∏£‡∏∞‡∏ß‡∏±‡∏á: ${q.caution}</div>` : ''}
                </div>

                <div class="flex gap-2 justify-end items-center">
                    ${q.status === 'Waiting' ? `
                        <button onclick="skipQueue('${q.id}')" class="bg-amber-500/20 text-amber-400 hover:bg-amber-500 hover:text-black px-3 py-2 rounded-lg text-xs font-bold transition-all border border-amber-500/30 mr-auto">üöÄ ‡∏•‡∏±‡∏î‡∏Ñ‡∏¥‡∏ß</button>
                        <button onclick="updateStatus('${q.id}', 'Serving')" class="bg-green-600 hover:bg-green-500 px-4 py-2 rounded-lg text-xs font-bold text-white transition-all shadow-lg shadow-green-600/20">Start</button>
                    ` : ''}
                    ${q.status === 'Serving' ? `<button onclick="updateStatus('${q.id}', 'Done')" class="bg-blue-600 hover:bg-blue-500 px-4 py-2 rounded-lg text-xs font-bold text-white transition-all shadow-lg shadow-blue-600/20">Done</button>` : ''}
                    <button onclick="updateStatus('${q.id}', 'Delete')" class="bg-red-500/10 text-red-400 hover:bg-red-500 hover:text-white px-3 py-2 rounded-lg text-xs transition-all">Del</button>
                </div>
            </div>`;
    }

    function renderUI() {
        const serving = db_content.find(i => i.status === 'Serving');
        const waiting = db_content.filter(i => i.status === 'Waiting');
        const waitingWalkin = waiting.filter(i => i.orderType !== 'booking'); 
        const waitingBooking = waiting.filter(i => i.orderType === 'booking');

        const custQ = document.getElementById('cust-display-queue');
        const custN = document.getElementById('cust-display-name');
        if(custQ) custQ.innerText = serving ? serving.id : '-';
        if(custN) custN.innerText = serving ? serving.nickname : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏¥‡∏ß‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ';

        const custWaitingList = document.getElementById('cust-waiting-list');
        if(custWaitingList) {
            custWaitingList.innerHTML = waiting.length ? '' : '<div class="text-gray-500 text-center py-6 bg-white/5 rounded-2xl border border-white/5">‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏¥‡∏ß‡∏£‡∏≠...</div>';
            waiting.forEach(q => {
                const isBooking = q.orderType === 'booking';
                const isMe = q.id === myQueueId;
                custWaitingList.innerHTML += `
                    <div class="flex justify-between items-center p-4 bg-white/5 rounded-2xl animate-slide-in border ${isMe ? 'border-purple-500 bg-purple-900/20' : 'border-white/5'}">
                        <div class="flex items-center gap-4">
                            <div class="font-mono text-2xl font-bold ${isMe ? 'text-purple-400' : 'text-white'}">${q.id}</div>
                            <div>
                                <div class="text-gray-300 font-medium text-sm">${q.nickname} ${isMe ? '(‡∏Ñ‡∏∏‡∏ì)' : ''}</div>
                                ${isBooking ? `<div class="text-orange-400 text-[10px] font-bold">Booking: ${q.bookingTime}</div>` : ''}
                            </div>
                        </div>
                        <span class="status-badge ${isBooking ? 'bg-orange-500/10 text-orange-300 border-orange-500/20' : 'status-waiting'}">${isBooking ? 'Booking' : 'Waiting'}</span>
                    </div>`;
            });
        }

        if (activePage === 'admin') {
            document.getElementById('admin-display-queue').innerText = serving ? serving.id : '-';
            document.getElementById('admin-display-name').innerText = serving ? serving.nickname : 'No Serving';
            document.getElementById('count-waiting').innerText = waiting.length;
            document.getElementById('count-serving').innerText = serving ? 1 : 0;
            document.getElementById('count-total').innerText = db_content.length;
            document.getElementById('badge-walkin').innerText = waitingWalkin.length;
            document.getElementById('badge-booking').innerText = waitingBooking.length;

            const walkinListEl = document.getElementById('admin-walkin-list');
            walkinListEl.innerHTML = '';
            if(serving && serving.orderType !== 'booking') {
                 walkinListEl.innerHTML += `<div class="text-xs text-green-400 font-bold mb-2 uppercase tracking-widest">Now Serving</div>` + createAdminCard(serving, true);
            }
            if(waitingWalkin.length === 0 && (!serving || serving.orderType === 'booking')) {
                walkinListEl.innerHTML = '<div class="text-gray-500 text-center py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏¥‡∏ß Walk-in</div>';
            } else {
                waitingWalkin.forEach(q => walkinListEl.innerHTML += createAdminCard(q));
            }

            const bookingListEl = document.getElementById('admin-booking-list');
            bookingListEl.innerHTML = '';
            if(serving && serving.orderType === 'booking') {
                 bookingListEl.innerHTML += `<div class="text-xs text-green-400 font-bold mb-2 uppercase tracking-widest">Now Serving</div>` + createAdminCard(serving, true);
            }
            const sortedBookings = waitingBooking.sort((a,b) => {
                if(a.bookingDate !== b.bookingDate) return a.bookingDate.localeCompare(b.bookingDate);
                return a.bookingTime.localeCompare(b.bookingTime);
            });
            if(sortedBookings.length === 0 && (!serving || serving.orderType !== 'booking')) {
                bookingListEl.innerHTML = '<div class="text-gray-500 text-center py-8">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Booking</div>';
            } else {
                sortedBookings.forEach(q => bookingListEl.innerHTML += createAdminCard(q));
            }
        }
    }

    // --- LOGIC ---
    document.getElementById('customer-form').onsubmit = async (e) => {
        e.preventDefault();
        
        // ‡∏Ç‡∏≠‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ‡∏ó‡∏µ‡πà‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°
        if("Notification" in window && Notification.permission !== "granted") {
            Notification.requestPermission();
        }

        const btn = document.getElementById('submit-btn');
        btn.disabled = true;
        btn.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
        const fd = new FormData(e.target);
        
        // **NEW ID GENERATION LOGIC**
        // Extract number from all existing IDs (including completed ones) to find the absolute max
        const getRunNumber = (id) => parseInt(id.replace(/\D/g, '')) || 0;
        const maxId = db_content.reduce((max, item) => Math.max(max, getRunNumber(item.id)), 0);
        const nextId = "Q-" + String(maxId + 1).padStart(3, '0');
        
        const newEntry = {
            id: nextId,
            status: 'Waiting',
            timestamp: new Date().toISOString(),
            ...Object.fromEntries(fd.entries())
        };
        const updatedDB = [...db_content, newEntry];
        if (await saveToGithub(updatedDB)) {
            // SAVE TO LOCAL STORAGE
            localStorage.setItem('bloom_my_queue_id', nextId);
            localStorage.setItem('bloom_my_queue_status', 'Waiting');
            myQueueId = nextId;
            lastKnownStatus = 'Waiting';

            showToast('‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ñ‡∏¥‡∏ß‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠ ' + nextId, 'success');
            e.target.reset();
            switchCustomerView('queue');
            refreshData();
        } else {
            showToast('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏£‡∏´‡∏±‡∏™ Token', 'error');
        }
        btn.disabled = false;
        btn.innerText = '‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Ñ‡∏¥‡∏ß‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£';
    };

    async function updateStatus(id, newStatus) {
        let updatedDB;
        if (newStatus === 'Delete') {
             // Hard Delete (Remove from DB entirely)
            updatedDB = db_content.filter(i => i.id !== id);
        } else if (newStatus === 'Done') {
             // Soft Delete (Mark as Completed to keep history for ID generation)
            updatedDB = db_content.map(i => i.id === id ? { ...i, status: 'Completed' } : i);
        } else {
            updatedDB = db_content.map(i => {
                if (i.id === id) return { ...i, status: newStatus };
                if (newStatus === 'Serving' && i.status === 'Serving') return null; // Remove other serving statuses if single server (optional)
                return i;
            }).filter(Boolean);
        }
        if (await saveToGithub(updatedDB)) {
            showToast('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'success');
            refreshData();
        }
    }

    async function skipQueue(id) {
        const itemToSkip = db_content.find(i => i.id === id);
        if (!itemToSkip) return;
        const serving = db_content.filter(i => i.status === 'Serving');
        const waiting = db_content.filter(i => i.status === 'Waiting' && i.id !== id);
        const others = db_content.filter(i => i.status !== 'Serving' && i.status !== 'Waiting');
        const newOrder = [...serving, itemToSkip, ...waiting, ...others];
        if (await saveToGithub(newOrder)) {
            showToast(`üöÄ ‡∏•‡∏±‡∏î‡∏Ñ‡∏¥‡∏ß ${id} ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏≥‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`, 'success');
            refreshData();
        }
    }

    // --- ADMIN TABS LOGIC ---
    function switchAdminTab(tab) {
        activeAdminTab = tab;
        const tWalkin = document.getElementById('admin-tab-walkin');
        const tBooking = document.getElementById('admin-tab-booking');
        const lWalkin = document.getElementById('admin-walkin-list');
        const lBooking = document.getElementById('admin-booking-list');

        if(tab === 'walkin') {
            tWalkin.classList.add('active'); tBooking.classList.remove('active');
            lWalkin.classList.remove('hidden-elm'); lBooking.classList.add('hidden-elm');
        } else {
            tBooking.classList.add('active'); tWalkin.classList.remove('active');
            lBooking.classList.remove('hidden-elm'); lWalkin.classList.add('hidden-elm');
        }
    }

    function toggleSettings() {
        const p = document.getElementById('settings-panel');
        p.classList.toggle('hidden-elm');
    }

    function updateStatusIcon(state, code = '') {
        const dot = document.getElementById('status-dot');
        const text = document.getElementById('status-text');
        if(!dot || !text) return;
        if(state === 'error') {
            dot.className = 'w-2 h-2 rounded-full bg-red-500';
            text.innerText = `Offline (${code})`;
            text.className = 'text-[10px] text-red-400 uppercase tracking-widest';
        } else {
            dot.className = 'w-2 h-2 rounded-full bg-green-500 live-dot';
            text.innerText = 'Live System';
            text.className = 'text-[10px] text-green-400 uppercase tracking-widest';
        }
    }

    function showPage(page) {
        activePage = page;
        if (page === 'admin') {
            document.getElementById('login-modal').classList.remove('hidden-elm');
        } else {
            document.getElementById('page-customer').classList.remove('hidden-elm');
            document.getElementById('page-admin').classList.add('hidden-elm');
            document.getElementById('login-modal').classList.add('hidden-elm');
            toggleNavStyle('customer');
        }
    }

    function checkLogin() {
        if (document.getElementById('admin-pass').value === '1234') {
            document.getElementById('login-modal').classList.add('hidden-elm');
            document.getElementById('page-customer').classList.add('hidden-elm');
            document.getElementById('page-admin').classList.remove('hidden-elm');
            toggleNavStyle('admin');
            renderUI();
        } else {
            showToast('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
        }
    }

    function toggleNavStyle(active) {
        const c = document.getElementById('nav-customer'), a = document.getElementById('nav-admin');
        if (active === 'customer') {
            c.className = 'px-3 py-1.5 md:px-4 md:py-2 rounded-lg text-xs md:text-sm font-medium bg-purple-600 text-white shadow-lg whitespace-nowrap';
            a.className = 'px-3 py-1.5 md:px-4 md:py-2 rounded-lg text-xs md:text-sm font-medium text-gray-400 whitespace-nowrap';
        } else {
            a.className = 'px-3 py-1.5 md:px-4 md:py-2 rounded-lg text-xs md:text-sm font-medium bg-purple-600 text-white shadow-lg whitespace-nowrap';
            c.className = 'px-3 py-1.5 md:px-4 md:py-2 rounded-lg text-xs md:text-sm font-medium text-gray-400 whitespace-nowrap';
        }
    }

    function switchCustomerView(view) {
        const f = document.getElementById('customer-form-view'), q = document.getElementById('customer-queue-view');
        const bf = document.getElementById('btn-view-form'), bq = document.getElementById('btn-view-queue');
        if (view === 'form') {
            f.classList.remove('hidden-elm'); q.classList.add('hidden-elm');
            bf.className = 'flex-1 py-3 rounded-2xl font-bold bg-white text-purple-900 shadow-lg scale-105 text-sm md:text-base';
            bq.className = 'flex-1 py-3 rounded-2xl font-bold bg-white/10 text-purple-300 text-sm md:text-base';
        } else {
            q.classList.remove('hidden-elm'); f.classList.add('hidden-elm');
            bq.className = 'flex-1 py-3 rounded-2xl font-bold bg-white text-purple-900 shadow-lg scale-105 text-sm md:text-base';
            bf.className = 'flex-1 py-3 rounded-2xl font-bold bg-white/10 text-purple-300 text-sm md:text-base';
            refreshData();
        }
    }

    function switchFormTab(type) {
        document.getElementById('form-order-type').value = type;
        document.getElementById('booking-section').className = type === 'booking' ? 'mt-6 animate-slide-in' : 'hidden-elm';
        document.getElementById('tab-walkin').className = type === 'walkin' ? 'flex-1 py-3 rounded-xl font-medium text-sm transition-all tab-btn active' : 'flex-1 py-3 rounded-xl font-medium text-sm transition-all tab-btn';
        document.getElementById('tab-booking').className = type === 'booking' ? 'flex-1 py-3 rounded-xl font-medium text-sm transition-all tab-btn active' : 'flex-1 py-3 rounded-xl font-medium text-sm transition-all tab-btn';
    }

    function showToast(m, t) {
        const c = document.getElementById('toast-container'), el = document.createElement('div');
        el.className = `animate-slide-in px-6 py-4 rounded-2xl text-white text-sm shadow-2xl pointer-events-auto ${t==='success'?'bg-green-600/90':'bg-red-600/90'}`;
        el.innerText = m; c.appendChild(el);
        setTimeout(() => el.remove(), 4000);
    }
  </script>
 </body>
</html>
